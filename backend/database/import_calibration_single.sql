-- Import ALL Calibration Records in ONE Transaction
-- Run this ENTIRE script in Supabase SQL Editor

-- First truncate to ensure clean state
TRUNCATE TABLE calibration_records RESTART IDENTITY;

-- Insert all calibration records using a multi-value INSERT
INSERT INTO calibration_records (equipment_id, calibration_date, expiry_date, certificate_number, calibration_provider)
SELECT e.id, v.cal_date::DATE, v.exp_date::DATE, v.cert_num, v.provider
FROM (
    VALUES
    ('03362', '2025-05-05', '2027-05-01', '03362-20250506-43457', 'Fixturlaser South Africa (Pty) Ltd'),
    ('41718', '2025-03-10', '2026-03-10', '41718-20250310', 'Acoem'),
    ('85889', '2025-05-05', '2027-05-01', '85889-20250505-43457', 'Fixturlaser South Africa (Pty) Ltd'),
    ('95889', '2025-05-05', '2027-05-01', '95889-20250505-43457', 'Fixturlaser South Africa (Pty) Ltd'),
    ('49002016', '2025-09-01', '2026-09-01', '135305-1', 'Repair and Metrology Services (Pty) Ltd'),
    ('49004275', '2024-12-04', '2026-12-04', '1504250247 152 04', 'Hersteller'),
    ('49022264', '2024-02-13', '2026-02-13', '49475264_ 2024_02_13', 'Hersteller'),
    ('49110800', '2024-02-14', '2026-02-14', '49140800 2024_02_14', 'Hersteller'),
    ('55905783', '2025-01-20', '2026-01-20', '132288-1', 'Flir'),
    ('79302627', '2025-10-29', '2026-10-29', '136287-1', 'Flir'),
    ('79318361', '2025-03-17', '2026-03-17', '132711-1', 'Flir'),
    ('84510173', '2025-06-19', '2026-06-19', '134294-1', 'Flir'),
    ('ATSX1119', '2025-07-14', '2028-07-13', 'VC0000029', 'All Test Pro'),
    ('AT701667', '2025-02-03', '2026-02-03', 'TVC0000005', 'All Test Pro'),
    ('9110D', '2025-11-12', '2026-11-12', 'PRD-P297', 'The Modal Shop'),
    ('B2140140724', '2025-10-31', '2026-10-30', 'C10-202549', 'Emerson'),
    ('B2140140833', '2025-10-31', '2026-10-30', 'C10-202555', 'Emerson'),
    ('B21401150773', '2025-10-31', '2026-10-30', 'C10-202542', 'Emerson'),
    ('B21401161342', '2025-03-28', '2026-03-27', 'C03-202533', 'Emerson'),
    ('B21401172280', '2025-04-01', '2026-04-01', 'C04-202534', 'Emerson'),
    ('B21401172281', '2025-10-31', '2026-10-30', 'C10-202554', 'Emerson'),
    ('B21401183989', '2025-10-31', '2026-10-30', 'C10-202539', 'Emerson'),
    ('B21401195137', '2025-04-11', '2026-04-11', 'C04-202540', 'Emerson'),
    ('B21401216460', '2025-10-31', '2026-10-30', 'C10-202544', 'Emerson'),
    ('B21401216461', '2025-10-31', '2026-10-30', 'C10-202541', 'Emerson'),
    ('B21401216462', '2025-10-31', '2026-10-30', 'C10-202557', 'Emerson'),
    ('B21401216467', '2025-10-31', '2026-10-30', 'C10-202545', 'Emerson'),
    ('B21401216468', '2025-10-31', '2026-10-30', 'C10-202560', 'Emerson'),
    ('B21401216469', '2025-03-28', '2026-03-27', 'C03-202531', 'Emerson'),
    ('B21401216472', '2025-10-31', '2026-10-30', 'C10-202557', 'Emerson'),
    ('B21401216473', '2025-10-31', '2026-10-30', 'C10-202559', 'Emerson'),
    ('B21401216474', '2025-10-31', '2026-10-30', 'C10-202547', 'Emerson'),
    ('B21401216475', '2025-09-03', '2026-09-02', 'C09-202501', 'Emerson'),
    ('B21401216476', '2025-10-31', '2026-10-30', 'C10-202553', 'Emerson'),
    ('B21401216478', '2025-10-31', '2026-10-30', 'C10-202556', 'Emerson'),
    ('B21401216479', '2025-10-31', '2026-10-30', 'C10-202543', 'Emerson'),
    ('B21401216480', '2025-10-31', '2026-10-30', 'C10-202551', 'Emerson'),
    ('B21401216481', '2025-10-31', '2026-10-30', 'C10-202552', 'Emerson'),
    ('B21401237748', '2025-10-31', '2026-10-30', 'C10-202546', 'Emerson'),
    ('B21401237749', '2025-03-28', '2026-03-27', 'C03-202530', 'Emerson'),
    ('B21401237750', '2025-08-25', '2026-11-24', 'CP0051', 'Emerson'),
    ('B21401238055', '2025-03-29', '2026-03-28', 'C10-202548', 'Emerson'),
    ('B21401238056', '2025-03-28', '2026-03-27', 'C03-202532', 'Emerson'),
    ('B21401238057', '2025-08-25', '2026-11-24', 'CP0051', 'Emerson'),
    ('B21401238058', '2025-10-31', '2026-10-30', 'C10-202540', 'Emerson'),
    ('B21401248300', '2025-07-04', '2026-07-03', 'C07-202501', 'Emerson'),
    ('B21401248304', '2025-09-03', '2026-09-02', 'C09-202502', 'Emerson'),
    ('B21401248305', '2025-07-04', '2026-07-03', 'C07-202502', 'Emerson'),
    ('B21401283996', '2025-10-31', '2026-10-30', 'C10-202550', 'Emerson'),
    ('B21402258100', '2025-08-21', '2026-08-21', 'CP0051', 'Emerson'),
    ('B21402258101', '2025-08-21', '2026-03-19', 'CP0051', 'Emerson'),
    ('30420018', '2025-02-05', '2026-02-05', '177176', 'Fluke'),
    ('C0206541485411', '2024-08-28', '2026-02-28', 'CAL-500-002', 'Tektronix Monarch'),
    ('MY52100243', '2025-01-23', '2026-01-23', '176515', 'Agilent'),
    ('B21401248303', '2025-07-07', '2026-07-07', 'CO7-202503', 'Emerson'),
    ('B2140140918', '2025-09-23', '2026-01-23', 'MHM-97905-PBF', 'Emerson'),
    ('87984', '2024-04-29', '2025-04-29', '87984-20240429', 'Fixturlaser South Africa (Pty) Ltd'),
    ('87986', '2024-04-29', '2025-04-29', '87986-20240429', 'Fixturlaser South Africa (Pty) Ltd'),
    ('87988', '2024-04-29', '2025-04-29', '87988-20240429', 'Fixturlaser South Africa (Pty) Ltd'),
    ('97984', '2024-04-29', '2025-04-29', '97984-20240429', 'Fixturlaser South Africa (Pty) Ltd'),
    ('97986', '2024-04-29', '2025-04-29', '97986-20240429', 'Fixturlaser South Africa (Pty) Ltd'),
    ('97988', '2024-04-29', '2025-04-29', '97988-20240429', 'Fixturlaser South Africa (Pty) Ltd'),
    ('63945556', '2024-10-21', '2025-10-21', '131315-2', 'Flir'),
    ('845009095', '2024-12-11', '2025-12-11', '131508-1', 'Flir'),
    ('84508577', '2024-10-21', '2025-10-21', '131315-1', 'Flir'),
    ('11755', '2025-11-12', '2026-11-12', '2649.01', 'The Modal Shop')
) AS v(serial, cal_date, exp_date, cert_num, provider)
JOIN equipment e ON e.serial_number = v.serial;

-- Verify import result
SELECT 'Imported records:' as info, COUNT(*) as count FROM calibration_records;

-- Show calibration status breakdown
SELECT 
    CASE 
        WHEN expiry_date < CURRENT_DATE THEN 'Expired'
        WHEN expiry_date <= CURRENT_DATE + INTERVAL '30 days' THEN 'Due Soon'
        ELSE 'Valid'
    END as status,
    COUNT(*) as count
FROM calibration_records
GROUP BY 1
ORDER BY 
    CASE 
        WHEN expiry_date < CURRENT_DATE THEN 1
        WHEN expiry_date <= CURRENT_DATE + INTERVAL '30 days' THEN 2
        ELSE 3
    END;
